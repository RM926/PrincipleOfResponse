# 一、Vue响应式系统

- 数据 ==> 视图，数据驱动视图变化

- 原理：1.观察者模式；2.Object.defineProperty(obj,attribute,{get(){},set(){})

  > 双向绑定（v-model）是对input框绑定了input事件，在input框输入的时候即会触发同个数据的set函数，set函数发送通知，通知相同依赖的数据也进行更新

# 二、class类的作用

- #### Vue

  负责**接收**初始化**数据**

  负责把**data中的属性注入到Vue实例**中，转化成 getter/setter,这一步让我们在获取值得时候，可以少写data这个对象

   负责**调用observer**监听data中所有属性的变化

   负责**调用compiler**解析指令/插值表达式

- #### Compiler

  负责**编译模板**，解析指令和插值表达式

  负责页面的**首次渲染**

  当数据发生变化后**重新渲染视图**

- #### Dep

  添加观察者（new Watch）

- #### Watch

  当数据变化触发依赖，dep通知所有的Watcher实例更新视图

  自身实例化的时候往dep对象中添加自己

- #### Observer

  负责把data选项中的属性转换成响应式数据

  data中的某个属性也是对象，把该属性转换成响应式数据

  数据变化发送通知，......这一步在object.defineProperty()方法中的set（）触发dep.notify()

# 三、关联

实例化一个Vue对象后，Vue的响应式系统中的Vue实例化对象会调用Observer对象，将所用到的数据全部赋予getting和setting方法；调用Compiler对象完成初次数据替换渲染，在用到数据的时候，并调用该数据的Watch对象，利用get方法将对应的Watch对象加入到同个数据的Dep对象收集器中，如果某个数据发生改变，会该数据的set方法，进而调用数据自身的更新函数。

关于Watcher：

- 同个数据依赖的watcher如何更新视图？

  因为每个数据都已经有set和get方法，当某个数据被更新的时候，会调用set方法，进而触发dep对象的notify方法去通知所有的依赖进行更新（同个数据会有一个dep类，dep类保存着同个数据不同位置（指同个数据可以是被用在插值表达式或者指令当中）的依赖（watch类），每个Watch的类都有属于自己的updata函数，应为放置在不同位置的更新方式是不一样的。

- watcher对象在何时实例化？怎样加入同个数据的dep中？

  在首次渲染中，如果有插值表达式和指令的使用，就会实例化一个watch对象，watch对象会调用一下自身的数据，触发该数据的get方法，将自身（watch对象）加入到Dep收集器中

模拟按步骤走完一整个流程。

每个数据都有自己的getter和setter方法

每个数据都有一个Dep类的实例对象dep， 储存依赖同一个数据的一个个Watcher

```
data -> dep:[watcher1,watcher2]
```

watcher是在解析document节点的时候创建的

同一个{{value}}，如何放置在同一个dep中

```javascript
var message = {
    dep :{
        subs:[{
              updata:function(){}
              },{
                  updata:function(){}
              }]
        notify:
    }
    get(){
        
    }
	set(newvalue){
        
    }
}

```

# 四、用到的属性和方法

- 属性

  ```javascript
  //获取某个元素的子元素，不包括**文本节点**，只有元素节点
  el.children
  //获取某个元素的子节点，包括文本节点和元素节点
  el.childNodes
  //获取元素节点所有的属性,是一个NamedNodeMap，属性值的获取为：el.attributes[num].name
  el.attributes
  //获取元素节点的内容
  el.textContent
  ```

- 方法

  ```javascript
  //类数组（是对象但有length属性）转换为数组
  Array.from()
  //字符串，截取字符串，如果省略第二个长度参数，则会截取到最后，return 截取的字段
  string.substr(start,length)
  //字符串，替代,第一个参数searchvalue通常会使用正则表达式去进行全局的替换 /替换的字符/g
  string.replace(searchvalue,newvalue)
  //判断字符串的起始字符,第二个参数起始位置不写默认为0
  string.startsWith(searchvalue, start)
  //对象遍历
  Object.keys()   
  Object.values() 
  ```

  

